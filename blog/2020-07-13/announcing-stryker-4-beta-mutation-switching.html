<!DOCTYPE html><html lang="en"><head><meta charset="utf8"><meta http-equiv="X-UA-Compatible" content="chrome=1"><meta name="description" content="Stryker: Blog"><title>Blog - Stryker Mutator</title><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Lato"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/svg+xml" href="/images/stryker.svg"><link rel="alternate icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="alternate icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#b74934"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#b74934"><meta name="google-site-verification" content="dcR3wjiLytpKDUxRuQskHBDnuZmrf58jOUjMANVpOn0"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/all.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous"></head><body><nav class="navbar sticky-top navbar-expand-md navbar-dark bg-secondary flex-column flex-md-row"><div class="container">   <a class="navbar-brand" href="/"><img src="/images/stryker.svg" alt="Stryker" width="30" height="30"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbar"><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="/stryker/" title="stryker">For JavaScript</a></li><li class="nav-item"><a class="nav-link" href="/stryker-net/" title="stryker-net">For C#</a></li><li class="nav-item"><a class="nav-link" href="/stryker4s/" title="stryker4s">For Scala</a></li><li class="nav-item active"><a class="nav-link" href="/blog" title="blog">Blog</a></li><li class="nav-item"><a class="nav-link" href="/example" title="example">An example</a></li><li class="nav-item"><a class="nav-link" href="https://github.com/stryker-mutator/stryker-handbook#readme" title="handbook" target="_blank">Handbook</a></li><li class="nav-item"><a class="nav-link" href="https://dashboard.stryker-mutator.io" title="dashboard" target="_blank">Dashboard</a></li></ul></div></div><a class="d-flex align-items-center" href="https://github.com/stryker-mutator/" id="forkme_banner"> <span class="d-none d-lg-block">View me on GitHub</span><i class="fab fa-github"></i></a></nav><main><div class="container mt-3"><div class="row"><div class="col-md-12"><h1>Announcing Stryker 4.0 Beta: Mutation Switching</h1><p>Published: 13 July 2020</p><p class="lead">We're excited to announce the beta of the next major release of the Stryker mutation testing framework for JavaScript and friends: Stryker 4.0.</p><p>If you're new to mutation testing, it's a way to measure your tests' effectiveness. Please take a look at <a href="/example">our RoboBar 🤖🍷 example</a> and see how even 100% code coverage doesn't tell the whole story.  Mutation testing is the only way to make sure your code is thoroughly tested.</p>
<p>This beta is a huge milestone because it means a fundamental shift in the way Stryker works internally. It now uses &quot;Mutation switching&quot;, a technique that can improve performance.</p>
<p>This, unfortunately, couldn't be done without breaking changes. These changes are mostly limited to the internal plugin API's except for the changes highlighted in this blog article.</p>
<p>To get started using the beta, update your Stryker dependencies using npm or yarn.</p>
<pre><code class="language-shell">npm install --save-dev @stryker-mutator/core@next
</code></pre>
<p>Don't forget to update Stryker plugins. For example, when using mocha:</p>
<pre><code class="language-shell">npm install --save-dev @stryker-mutator/mocha-runner@next
</code></pre>
<p>This beta is released early, in order to get community feedback. We've not yet updated the docs with the changes specified in this blog article. At this moment, the jest-runner and the command test runner <em>still need to be migrated and will not work as expected</em>.</p>
<p>Let's dive into the good stuff.</p>
<ul>
<li><a href="#mutation-switching">👽 Mutation switching</a></li>
<li><a href="#instrumentation-with-babel">🐠 Instrumentation with Babel</a></li>
<li><a href="#build-command-support">👷‍‍ Build command support</a></li>
<li><a href="#checker-plugin">✅ Checker plugin</a></li>
<li><a href="#more-coverage-analysis">☔ More coverage analysis</a></li>
<li><a href="#other-changes">🧹 Other changes</a></li>
<li><a href="#whats-next">🔮 What's next</a></li>
</ul>
<h2 id="mutation-switching"><a class="stryker-permalink" href="#mutation-switching">🔗</a> 👽 Mutation switching</h2>
<p>Mutation switching is a way to simultaneously put all mutants into your code while making sure only one mutant is active at the same time. Let's take a look at an example.</p>
<p>Let's take this.</p>
<pre><code class="language-js">function add(a, b) {
return a + b;
}
</code></pre>
<p>When you feed this code to Stryker, it will generate two mutants:</p>
<p>👽 <code>function add(a, b) { return a - b }</code><br>
👾 <code>function add(a, b) {}</code></p>
<p>Previous versions of Stryker would make two copies of the source code. One for each mutant. This changes with Stryker 4.0. Both mutants will be placed into the code <em>at the same time</em>.</p>
<pre><code class="language-js">function add(a, b) {
  if (global.activeMutant === 0) {
  } else {
    return global.activeMutant === 1? a - b: a+b;
  }
}
</code></pre>
<p>(simplified example)</p>
<p>Stryker can now run your tests twice while changing which mutant is active in the process. Mutation switching can improve performance dramatically, depending on the type of project. For example, when you bundle your code with webpack before running the tests, then webpack only needs to run once. The same goes for TypeScript projects where you compile your code before testing.</p>
<h2 id="instrumentation-with-babel"><a class="stryker-permalink" href="#instrumentation-with-babel">🔗</a> 🐠 Instrumentation with Babel</h2>
<p>Mutation Switching is a significant performance improvement, but it means that Stryker is required to perform some complex transformations of the <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" target="_blank" rel="noopener">Abstract Syntax Tree (AST)</a>.</p>
<p>Doing this <em>instrumentation</em> means visiting each node of the AST to collect and place mutants. This instrumentation is implemented with the <a href="babeljs.io/">Babel</a> parser <em>only</em> and now ships with <code>@stryker-mutator/core</code>. We're taking advantage of Babel 7's support to parse and print TypeScript code.</p>
<p>This means that it is <em>no longer needed to configure the <code>mutator</code></em> in your Stryker configuration. Stryker will always use the new mutation instrumenter. It supports TypeScript, JavaScript, Flow, and JSX. It even can even parse HTML in <code>.html</code> or <code>.vue</code> files and mutate the script tags inside them. It also picks up your babel configuration out-of-the-box, so no custom configuration is needed.</p>
<h2 id="build-command-support"><a class="stryker-permalink" href="#build-command-support">🔗</a> 👷‍‍ Build command support</h2>
<p>With mutation switching, all mutants are placed in the code at the same time. This also means that it only has to be built (transpiled or bundled) once.</p>
<p><em>Note: not all projects need building. Simple projects might deploy JS code as is, or the test runner might take care of this step for you. For example, running your tests with <code>ts-node</code> or <code>babel/register</code> or running it with <code>Jest</code> or <code>Karma</code> with the <a href="https://github.com/webpack-contrib/karma-webpack" target="_blank" rel="noopener">webpack plugin</a>.</em></p>
<p>Before mutation switching, this would be the job of the <code>transpiler</code> plugin type. For example, <code>transpiler: ['babel']</code> would mean that all files would be transpiled with the <code>@stryker-mutator/babel-transpiler</code> plugin. It was a bit complex to create a transpiler plugin, and since every mutant needed to transpiled, it was slow. Every transpiler/bundler needed its a transpiler plugin.</p>
<p>Stryker 4.0 will no longer support the <code>transpiler</code> plugins. Instead, it allows you to configure a <code>buildCommand</code> yourself. A build command can be any command. Some examples include <code>npm run build</code>, <code>tsc -b</code> or <code>webpack --config webpack.config</code>. This means that the available plugins do not limit you.</p>
<p>The following dependencies are therefore no longer needed, and you can simply remove them:</p>
<ul>
<li><code>@stryker-mutator/babel-transpiler</code></li>
<li><code>@stryker-mutator/webpack-transpiler</code></li>
<li><code>@stryker-mutator/typescript</code></li>
</ul>
<h2 id="checker-plugin"><a class="stryker-permalink" href="#checker-plugin">🔗</a> ✅ Checker plugin</h2>
<p>You might know that the old <code>@stryker-mutator/typescript</code> transpiler not only transpiled your code but also filtered out mutants that resulted in type errors, marking them with <code>compile error</code> (or <code>transpile error</code>) in your report. Mutants with this status are marked as &quot;invalid&quot; and do not influence your mutation score.</p>
<p>Since Stryker 4.0 <a href="#build-command-support">removes the transpiler plugin type</a> we needed a new plugin that can perform this type checking. Introducing the <code>Checker</code> plugin type. In the Stryker 4 release, we will include one such checkers, the <code>@stryker-mutator/typescript-checker</code>.</p>
<p>Install it with <code>npm install @stryker-mutator/typescript-checker@next</code></p>
<p>Configure it with:</p>
<pre><code class="language-ts">{
  &quot;checkers&quot;: [&quot;typescript&quot;],
  &quot;tsconfigFile&quot;: &quot;tsconfig.json&quot;
}
</code></pre>
<p>(tsconfig.json is the default setting for &quot;tsconfigFile&quot;).</p>
<p>Please see <a href="https://github.com/stryker-mutator/stryker/tree/epic/mutation-switching/packages/typescript-checker#readme" target="_blank" rel="noopener">the TypeScript checker's readme for more details</a></p>
<h2 id="more-coverage-analysis"><a class="stryker-permalink" href="#more-coverage-analysis">🔗</a> ☔ More coverage analysis</h2>
<p>Coverage analysis is a way to speed up mutation testing. Stryker always came with three flavors:
&quot;off&quot;: No coverage analysis
&quot;all&quot;: Coverage is measured for the entire test suite. Mutants that are not covered by even one test are marked with &quot;NoCoverage&quot;
&quot;perTest&quot;: Coverage is measured per test. Only tests that cover a specific mutant are run for that mutant.
Running with &quot;perTest&quot; coverage yields a significant performance improvement (usually between 40% and 60%). However, most projects were unable to take advantage of it because Stryker relied on a complex mechanism of <a href="https://istanbul.js.org/" target="_blank" rel="noopener">istanbul</a> code coverage combined with hooks in the test runner. It only worked in scenarios without complicated transpiling or bundling.</p>
<p>With the introduction of mutation switching, the instrumenter is responsible for inserting coverage instrumentation into the code. This means that Stryker can measure mutant coverage, <em>regardless of which bundler/transpiler you are using</em>. The only requirement is that Stryker needs to be able to hook into the test runner. This is currently supported for <code>@stryker-mutator/mocha-runner</code>, <code>@stryker-mutator/karma-runner</code> and <code>@stryker-mutator/jasmine-runner</code>. Support for <a href="https://github.com/stryker-mutator/stryker/issues/2316" target="_blank" rel="noopener"><code>@stryker-mutator/jest-runner</code> is planned</a>.</p>
<h2 id="other-changes"><a class="stryker-permalink" href="#other-changes">🔗</a> 🧹 Other changes</h2>
<p>We also decided to take this opportunity to improve the maintainability of the Stryker code further. That's why we've decided to drop support for two more plugin types.</p>
<ul>
<li>The <code>TestFramework</code> plugin type is removed<br>
A test framework plugin used to be responsible for allowing Stryker to hook into the test framework to implement test filtering and perTest coverage analysis. In practice, this was often tightly coupled to the test runner itself. That's why we've decided to drop this plugin type and make the Test Runner plugin responsible for hooking into the test framework directly. Therefore the following dependencies can simply be removed: <code>@stryker-mutator/mocha-framework</code> and <code>@stryker-mutator/jasmine-framework</code>.</li>
<li>The <code>OptionsEditor</code> plugin type is removed<br>
Options editors provided a way for plugins to edit the Stryker options directly. In practice, this was used to load plugin-specific options and attach them to the StrykerOptions object for later use. Plugins are now expected to load their options in their life cycle.</li>
</ul>
<h2 id="whats-next"><a class="stryker-permalink" href="#whats-next">🔗</a> 🔮 What's next</h2>
<p>We'll be focussing on getting Stryker 4.0 released. For that to happen, we would appreciate your feedback. Feel free to report any <a href="https://github.com/stryker-mutator/stryker/issues/new" target="_blank" rel="noopener">issues</a> you have with this beta release.</p>
<p>Want to get in touch? Find us on <a href="https://join.slack.com/t/stryker-mutator/shared_invite/enQtOTUyMTYyNTg1NDQ0LTU4ODNmZDlmN2I3MmEyMTVhYjZlYmJkOThlNTY3NTM1M2QxYmM5YTM3ODQxYmJjY2YyYzllM2RkMmM1NjNjZjM" target="_blank">Slack</a> or <a href="https://twitter.com/stryker_mutator" target="_blank">Twitter</a>.</p><a href="/blog.html" title="blog">Back to blogs</a></div></div><footer class="navbar navbar-footer"><div class="container"><p class="navbar-text">Stryker is released under the Apache 2.0 license. Site by Nico Jansen, Simon de Lang and Alex van Assem. Logo by Selina van den Top.</p></div></footer><script src="/js/all.bundle.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-104444094-1', 'auto');
ga('send', 'pageview');</script></div></main></body></html>